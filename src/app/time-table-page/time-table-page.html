<div class="bg-white border-b border-gray-200 p-4">
  <h1 class="text-2xl font-bold text-gray-800">Event Time Table</h1>
</div>

<mat-tab-group
  [(selectedIndex)]="selectedDayIndex"
  mat-stretch-tabs="false"
  class="h-screen"
>
  @for (d of days; track d.date) {
    <mat-tab>
      <ng-template mat-tab-label>
        <div class="flex flex-col items-center px-3 py-1">
          <div class="font-semibold">{{ d.label }}</div>
          <div class="text-[11px]">{{ d.date }}</div>
        </div>
      </ng-template>

      <div class="relative">

        <div class="pl-[67px]">
          <div
            #venueHeader
            class="sticky top-0 z-40 bg-gray-300 border-b border-gray-400 overflow-x-auto"
            [scrollLeft]="contentScrollLeft"
          >
            <div class="grid grid-flow-col auto-cols-[300px]" [style.width.px]="venues.length * 300">
              @for (v of venues; track v.id) {
                <div class="p-2 text-center border-r border-gray-400">
                  {{ v.name }}
                </div>
              }
            </div>
          </div>
        </div>

        <div class="h-[550px] overflow-y-auto">
          <div class="flex">


            <div class="w-[67px] flex-shrink-0 bg-white border-r border-gray-300">
              @for (t of timeSlots; let i = $index; track $index) {
                <div
                  class="w-full flex items-center px-4 border-b border-gray-300"
                  [ngClass]="{ 'bg-gray-50': i % 2 === 0 }"
                  [style.height.px]="slotHeight"
                >
                  {{ t }}
                </div>
              }
            </div>


            <div
              #contentScroll
              class="overflow-x-auto flex-1"
              (scroll)="onContentScroll($event)"
            >

              <div class="relative" [style.width.px]="venues.length * 300">

                <div class="grid grid-flow-col auto-cols-[300px]">
                  @for (v of venues; track v.id) {
                    <div>
                      @for (t of timeSlots; let i = $index; track $index) {
                        <div
                          class="w-full border-b border-r border-gray-300"
                          [ngClass]="{ 'bg-gray-50': i % 2 === 0 }"
                          [style.height.px]="slotHeight"
                        ></div>
                      }
                    </div>
                  }
                </div>


                <div class="absolute inset-0 pointer-events-none">
                  @for (ev of eventsForSelectedDay; track ev.id) {
                    <div
                      class="absolute box-border bg-slate-300 border border-slate-500
                 overflow-hidden text-[11px] flex flex-col items-center justify-center pointer-events-auto"
                      [style.top.px]="getEventTopPx(ev)"
                      [style.height.px]="getEventHeightPx(ev)"
                      [style.left.px]="getLeftPercent(ev)"
                      [style.width.px]="getEventWidthPx(ev)"
                    >
                      <div class="font-semibold">{{ ev.title }}</div>
                      <div class="text-[10px] opacity-80">{{ ev.start }} - {{ ev.end }}</div>
                    </div>
                  }
                </div>

              </div>
            </div>

          </div>
        </div>
      </div>
    </mat-tab>
  }
</mat-tab-group>
